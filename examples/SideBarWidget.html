<!DOCTYPE html>
<html>
  <head>
    <title>SideBar Widget example</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/default.css" />
  </head>
  <body>
    <script src="../packages/browser/dist/RUN_MODE/bundle.js"></script>

    <script type="text/javascript">
      udvizBrowser.FileUtil.loadMultipleJSON([
        './assets/config/scene.json',
        './assets/config/extent_lyon.json',
        './assets/config/frame3D_planars.json',
        './assets/config/server/spatial_multimedia_db_server.json',
        './assets/config/server/geocoding_server.json',
        './assets/config/server/sparql_server.json',
        './assets/config/styles.json',
        './assets/config/widget/temporal.json',
        './assets/config/widget/slide_show.json',
        './assets/config/widget/sparql_widget.json',
        './assets/config/layer/3DTiles.json',
        './assets/config/layer/base_maps.json',
        './assets/config/layer/elevation.json',
        './assets/config/layer/geoJSONs.json',
        './assets/config/layer/labels.json',
      ]).then((configs) => {
        // http://proj4js.org/
        // define a projection as a string and reference it that way
        // the definition of the projection should be in config TODO_ISSUE
        udvizBrowser.proj4.default.defs(
          configs['extent_lyon'].crs,
          '+proj=lcc +lat_1=45.25 +lat_2=46.75' +
            ' +lat_0=46 +lon_0=3 +x_0=1700000 +y_0=5200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'
        );

        const extent = new udvizBrowser.itowns.Extent(
          configs['extent_lyon'].crs,
          parseInt(configs['extent_lyon'].west),
          parseInt(configs['extent_lyon'].east),
          parseInt(configs['extent_lyon'].south),
          parseInt(configs['extent_lyon'].north)
        );

        const app = new udvizBrowser.SideBarWidget(
          extent,
          configs['frame3D_planars'][2],
          configs['scene']
        );

        app.addLayers({
          $3DTiles: configs['3DTiles'],
          elevation: configs['elevation'],
          baseMap: configs['base_maps'][0],
          labels: configs['labels'],
          geoJSON: configs['geoJSONs'],
        });

        app.addLogos([
          './assets/img/logo/logo-grand-lyon.png',
          './assets/img/logo/logo-imu.png',
          './assets/img/logo/logo-liris.png',
          './assets/img/logo/logo-univ-lyon.png',
        ]);

        app.addWidgetAuthentication(
          configs['spatial_multimedia_db_server'],
          './assets/svg/user-solid.svg'
        );

        // ABOUT HTML
        const aboutHtml = document.createElement('div');
        aboutHtml.innerHTML = `<h1> About </h1><div>
          <br>
          <p>This UD-Viz-Shared demo is part of the
              <a target="_blank" href="https://github.com/VCityTeam/UD-Viz">Urban Data Viewer</a>
              (UD-Viz) project of the
              <a target="_blank" href="https://projet.liris.cnrs.fr/vcity/">VCity project</a>
              from
              <a target="_blank" href="https://liris.cnrs.fr/en">LIRIS lab</a>
              (with additional support from
              <a target="_blank" href="http://imu.universite-lyon.fr/"">LabEx IMU</a>).</p>
              <p>UD-Viz-Shared demo is powered with
              <ul>
              <li><a href=" http://www.itowns-project.org/">iTowns</a></li>
              <li><a target="_blank" href="https://data.grandlyon.com">Lyon Métropole Open Data</a></li>
              </ul>
          </p>
          <p> <b>Legal and operational disclaimer:</b> This demonstration
              and its underlying software are provided “as is”. The authors
              and contributors disclaim all warranties with regard to the
              software including all implied warranties of merchantability
              and fitness for a particular purpose (refer to the spirit of
              any <a
                  href="https://en.wikipedia.org/wiki/BSD_licenses#2-clause_license_(%22Simplified_BSD_License%22_or_%22FreeBSD_License%22)">BSD
                  license</a> dislaimer).
          </p>
          <p>
              Nevertheless, if you notice any issue, help us by <a href="https://github.com/MEPP-team/UD-Viz/issues">openning
                  an
                  issue on github</a>
          </p>
          <p>
              Concerning user contributed data:
          <ul>
              <li>
                  the free usage with no warranty spirit also applies
                  to any user contributed data : in particular there are
                  no backups of any user contributed/uploaded data.
              </li>
              <li>
                  if you are a copyright owner and believe that content
                  available in this demo infringes one or more of your
                  copyrights, please <a href="https://github.com/VCityTeam/UD-Viz/issues">open an
                      issue on github</a> so that we can (best effort)
                  remove it from this site
              </li>
          </ul>
          </p>
          <p style="display: inline-block; color: white; margin: 0;">
              Icons made by <a href="https://www.freepik.com/" title="Freepik">Freepik</a> from
              <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a><br> is licensed by
              <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">
                  CC 3.0 BY</a>
          </p></div>`;

        app.addCustomHtml('./assets/svg/about.svg', aboutHtml, 'About');

        const helpHtml = document.createElement('div');
        helpHtml.innerHTML = `<a href="https://github.com/VCityTeam/UD-Viz/blob/master/docs/static/User/ContributeData.md">
        User Tutorial</a>
        <h2>Camera key bindings:</h2>
        <ul>
          <li>Left-Click: camera translation (drag)</li>
          <li>Right-Click: camera translation (pan)</li>
          <li>Ctrl + Left-Click: camera rotation (orbit)</li>
          <li>Spacebar / Wheel-Click: smart zoom</li>
          <li>Mouse Wheel: zoom in/out</li>
          <li>T: orient camera to a top view</li>
          <li>Y: move camera to start position</li>
        </ul>
        `;

        app.addCustomHtml('./assets/svg/help.svg', helpHtml, 'Help');

        app.addWidgetGeocoding(
          configs['geocoding_server'],
          './assets/svg/geocoding.svg'
        );

        app.addWidgetCityObject(
          configs['styles'],
          './assets/svg/cityObjects.svg'
        );

        app.addWidgetDebug3DTiles('./assets/svg/3dtilesDebug.svg');

        app.addWidgetDocument(
          configs['spatial_multimedia_db_server'],
          configs['styles'],
          './assets/svg/documents.svg'
        );

        app.addWidgetGuidedTour(
          configs['spatial_multimedia_db_server'],
          './assets/svg/guidedTour.svg'
        );

        app.addWidgetCameraPositioner('./assets/svg/cameraPositioner.svg');

        // this widget need that some temporal layers has been add because otherwiser no extension is registered and this is bugging
        // app.addWidgetTemporal(configs['temporal'], './assets/svg/temporal.svg');

        app.addWidgetLayerChoice('./assets/svg/layerChoice.svg');

        app.addWidgetSlideShow(
          configs['slide_show'],
          './assets/svg/slideShow.svg'
        );

        app.addWidgetSparql(
          configs['sparql_server'],
          configs['sparql_widget'],
          './assets/svg/sparqlModule.svg'
        );
      });
    </script>
  </body>
</html>
