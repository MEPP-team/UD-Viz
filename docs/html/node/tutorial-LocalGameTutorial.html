<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="custom.css"><title>Tutorial: LocalGameTutorial</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">@ud-viz/node</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="E7waCAy2XRqwWyiPHs27e"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ExpressAppWrapper.html">ExpressAppWrapper</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="ldqb2Wm34h2ZC-PZS5b5b"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Debug.html">Debug</a></div><div class="sidebar-section-children"><a href="module-Test.html">Test</a></div><div class="sidebar-section-children"><a href="module-udvizNode.html">udvizNode</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="6SktYTtJPiRmfyomlylaA"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-Changelog.html">Changelog</a></div><div class="sidebar-section-children"><a href="tutorial-ArchitectureMVCTargetDesign.html">ArchitectureMVCTargetDesign</a></div><div class="sidebar-section-children"><a href="tutorial-Configuring-the-Document-model-of-an-UDV-deployment.html">Configuring-the-Document-model-of-an-UDV-deployment</a></div><div class="sidebar-section-children"><a href="tutorial-Contributing.html">Contributing</a></div><div class="sidebar-section-children"><a href="tutorial-Definitions.html">Definitions</a></div><div class="sidebar-section-children"><a href="tutorial-LocalGameTutorial.html">LocalGameTutorial</a></div><div class="sidebar-section-children"><a href="tutorial-ReleasePublish.html">ReleasePublish</a></div><div class="sidebar-section-children"><a href="tutorial-Reproducibility.html">Reproducibility</a></div><div class="sidebar-section-children"><a href="tutorial-View3D.html">View3D</a></div><div class="sidebar-section-children"><a href="tutorial-ContributeData.html">ContributeData</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="Github" href="https://github.com/VCityTeam/UD-Viz" target="_blank">Github</a></div><div class="navbar-item"><a id="Examples" href="https://ud-viz.vcityliris.data.alpha.grandlyon.com/" target="_blank">Examples</a></div><div class="navbar-item"><a id="udvizHome" href="../" target="">udviz</a></div><div class="navbar-item"><a id="udvizBrowser" href="../browser" target="">udvizBrowser</a></div><div class="navbar-item"><a id="udvizShared" href="../shared" target="">udvizShared</a></div><div class="navbar-item"><a id="udvizNode" href="../node" target="">udvizNode</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h2>LocalGameTutorial</h2></header><article><h1 id="local-game-tutorial-%3Alion%3A">Local Game tutorial :lion:</h1><p>Welcome in the first ud-viz game tutorial. We will proceed step by step, if you want to consult the complete project, you can find it in this <a href="../../examples"><strong>folder</strong></a>. At the end of this tutorial you will fly with your zeppelin in the sky of Lyon, and collect some spheres!</p><p><img src="./Pictures/zeppelin.gif" alt="Zeppelin"></p><h1 id="create-your-game-project-%3Asmile%3A">Create your game project :smile:</h1><ul><li><a href="./LocalGameTutorial.md#working-environment">Working environment</a></li><li><a href="./LocalGameTutorial.md#initialize-your-project">Initialize your project</a></li><li><a href="./LocalGameTutorial.md#importing-ud-viz">Importing ud-viz</a></li><li><a href="./LocalGameTutorial.md#create-your-game">Create your game</a></li><li><a href="./LocalGameTutorial.md#parameterize-itowns-layers">Parameterize itowns layers</a></li></ul><h2 id="working-environment">Working environment</h2><p>Steps :</p><ul><li>Create an empty folder that you can call <code>My_UD-Viz_Game</code>.</li><li>Create a html script in your folder that you call <code>index.html</code>(<a href="../../examples/LocalGame.html">Check out the final version</a>).</li></ul><blockquote><p>Open the folder in visual studio code or your favorite IDE :computer:</p></blockquote><h2 id="initialize-your-project">Initialize your project</h2><p>To begin with, here is the <strong>base</strong> of an html script, <strong>copy it</strong>:</p><pre class="prettyprint source lang-html"><code>&lt;!--index.html-->
&lt;!DOCTYPE html>
&lt;html>
  &lt;head>
    &lt;title>My awesome game&lt;/title>

    &lt;meta charset=&quot;UTF-8&quot; />
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; />
  &lt;/head>
  &lt;body>&lt;/body>
&lt;/html>
</code></pre><p>Then you will need to host your game folder (<code>My_UD-Viz_Game</code>), to do so you can use your own local server otherwise follow these steps:</p><blockquote><p>If you chose to host with this way npm and node must be installed. (<a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm">Doc link</a>)</p></blockquote><ul><li>Clone the <code>UD-SimpleServer</code> repo separately:</li></ul><pre class="prettyprint source lang-bash"><code>git clone https://github.com/VCityTeam/UD-SimpleServer.git
</code></pre><ul><li>Open the SimpleServer repo in a terminal and install node packages:</li></ul><pre class="prettyprint source lang-bash"><code>npm install
</code></pre><ul><li>And finally host <code>My_UD-Viz_Game</code> folder with this command line:</li></ul><pre class="prettyprint source lang-bash"><code>node index.js PATH_TO_My_UD-Viz_Game 8000

# PATH_TO_My_UD-Viz_Game might be ../My_UD-Viz_Game if UD-SimpleServer is next to your game folder.
</code></pre><p>You can visit your page at http://localhost:8000/ but nothing is displayed (yet).</p><h2 id="importing-ud-viz">Importing ud-viz</h2><ul><li><p>Create a file <code>bootstrap.js</code> in a <code>src</code> folder</p></li><li><p>Install <a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm">npm / node</a></p></li><li><p>Create <code>package.json</code> file and fill with it :</p></li></ul><pre class="prettyprint source lang-json"><code>{
  &quot;name&quot;: &quot;game&quot;,
  &quot;description&quot;: &quot;My awesome game&quot;,
  &quot;main&quot;: &quot;./src/bootstrap.js&quot;
}
</code></pre><blockquote><p>You will need several node packages to run your application</p></blockquote><ul><li>To install <code>ud-viz</code> :</li></ul><p><code>npm i ud-viz</code></p><blockquote><p>A line has been added to your <code>package.json</code>, a <code>package-lock.json</code> file and a <code>node_modules</code> folder have been created</p></blockquote><p>Now you will create a bundle of your application to be able to import it into your html file.</p><ul><li>For this we will use webpack :</li></ul><p><code>npm i -D webpack webpack-cli css-loader style-loader</code></p><p>Your <code>package.json</code> should look like this :</p><pre class="prettyprint source lang-json"><code>{
  &quot;name&quot;: &quot;game&quot;,
  &quot;description&quot;: &quot;My awesome game&quot;,
  &quot;main&quot;: &quot;./src/bootstrap.js&quot;,
  &quot;dependencies&quot;: {
    &quot;ud-viz&quot;: &quot;^2.37.5&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;css-loader&quot;: &quot;^6.7.1&quot;,
    &quot;style-loader&quot;: &quot;^3.3.1&quot;,
    &quot;webpack&quot;: &quot;^5.73.0&quot;,
    &quot;webpack-cli&quot;: &quot;^4.10.0&quot;
  }
}
</code></pre><ul><li>Create a config for webpack in <code>webpack.config.js</code></li></ul><pre class="prettyprint source lang-js"><code>const path = require('path');

module.exports = {
  context: path.resolve('src/'),
  devtool: 'source-map',

  entry: {
    main: path.resolve(__dirname, 'src/bootstrap.js'),
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
  // Put the bundled code here: /dist/app.bundle.js
  output: {
    path: path.resolve(__dirname, 'dist/'),
    filename: 'app.bundle.js',
    libraryTarget: 'umd',
    umdNamedDefine: true,
  },
};
</code></pre><ul><li>Add <code>scripts</code> field in your <code>package.json</code></li></ul><pre class="prettyprint source lang-json"><code>{
  &quot;name&quot;: &quot;game&quot;,
  &quot;description&quot;: &quot;My awesome game&quot;,
  &quot;main&quot;: &quot;./src/bootstrap.js&quot;,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --mode production&quot;,
    &quot;build-debug&quot;: &quot;webpack --mode development&quot;
  },
  &quot;dependencies&quot;: {
    &quot;ud-viz&quot;: &quot;^2.37.5&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;css-loader&quot;: &quot;^6.7.1&quot;,
    &quot;style-loader&quot;: &quot;^3.3.1&quot;,
    &quot;webpack&quot;: &quot;^5.73.0&quot;,
    &quot;webpack-cli&quot;: &quot;^4.10.0&quot;
  }
}
</code></pre><ul><li>Add this line your <code>src/bootstrap.js</code> for import ud-viz</li></ul><pre class="prettyprint source lang-js"><code>import * as udviz from 'ud-viz';
</code></pre><ul><li><p>You can now use the command <code>npm run build</code> &amp; <code>npm run build-debug</code> (in our case, the advisor). It creates a <code>app.bundle.js</code> file in <code>dist</code> folder.</p></li><li><p>In your HTML file (<a href="/examples/LocalGame.html"><code>index.html</code></a>) add the following script tag in the <strong>&lt;body&gt;</strong>.</p></li></ul><pre class="prettyprint source lang-html"><code>&lt;script src=&quot;./dist/app.bundle.js&quot;>&lt;/script>
</code></pre><p>Still nothing displayed but the library is now globally accessible.</p><blockquote><p>You can also visit this <a href="https://github.com/VCityTeam/UD-Viz-Template">repository</a> to see an example of a npm project using ud-viz as a package.</p></blockquote><h2 id="create-your-game">Create your game</h2><ul><li>Add the following code to start a new local game in <code>src/bootsrap.js</code>:</li></ul><pre class="prettyprint source lang-js"><code>const myWorld = new udviz.Game.World({
  name: 'My World',
  origin: { lat: 45.7530993, lng: 4.8452654, alt: 300 },
  gameObject: {
    name: 'GameManager',
  },
});

const app = new udviz.Templates.LocalGame();
app.start(myWorld, './assets/config/local_game_config.json');
</code></pre><p>First a new world called <code>My World</code> is created, you have to specify at which 3D coordinates you want to create it. Here we take a random location in Lyon. We also specify our root game object which is here called <code>GameManager</code>.</p><p>Then a <a href="/src/Templates/LocalGame/LocalGame.js">LocalGame</a> is instanciated, to start it you need to pass a world and the path to a config file.</p><ul><li>Create a new folder called <code>./assets/config/</code> and, in it, a new file called <code>local_game_config.json</code>(<a href="/examples/assets/config/local_game_config.json">final version</a>) composed of the following code:</li></ul><pre class="prettyprint source lang-json"><code>{
  &quot;worldStateInterpolator&quot;: {
    &quot;renderDelay&quot;: 150
  },
  &quot;game&quot;: {
    &quot;fps&quot;: 30,
    &quot;shadowMapSize&quot;: 2046,
    &quot;radiusExtent&quot;: 1000,
    &quot;sky&quot;: {
      &quot;color&quot;: {
        &quot;r&quot;: 0.4,
        &quot;g&quot;: 0.6,
        &quot;b&quot;: 0.8
      },
      &quot;sun_position&quot;: {
        &quot;phi&quot;: 1,
        &quot;theta&quot;: 0.3
      }
    }
  }
}
</code></pre><p>Parameters in <code>game</code> section are relative to your <a href="/src/Views/GameView/GameView.js">GameView</a> (the framerate, the size of the shadow map and the sky color). The <code>itowns</code> parameter is used to crop the area around the location of your world.</p><p>Ok, at this point, your <strong>browser</strong> should display something like the following, namely a light blue background and a dark blue slab.</p><p><img src="./Pictures/1.png" alt="1"></p><h2 id="parameterize-itowns-layers">Parameterize itowns layers</h2><p>That's great, you don't know it yet but this is Lyon, ok let's make the city appeared !</p><ul><li>Let's add these lines in your <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> file</li></ul><pre class="prettyprint source lang-json"><code>&quot;background_image_layer&quot;: {
    &quot;url&quot;: &quot;https://download.data.grandlyon.com/wms/grandlyon&quot;,
    &quot;name&quot;: &quot;Ortho2018_Dalle_unique_8cm_CC46&quot;,
    &quot;version&quot;: &quot;1.3.0&quot;,
    &quot;format&quot;: &quot;image/jpeg&quot;,
    &quot;layer_name&quot;: &quot;Base_Map&quot;,
    &quot;transparent&quot;: true
},
&quot;elevation_layer&quot;: {
    &quot;url&quot;: &quot;https://download.data.grandlyon.com/wms/grandlyon&quot;,
    &quot;name&quot;: &quot;MNT2018_Altitude_2m&quot;,
    &quot;format&quot;: &quot;image/jpeg&quot;,
    &quot;layer_name&quot;: &quot;wms_elevation_test&quot;
}
</code></pre><p>Here we are parameterized layers of the <a href="http://www.itowns-project.org/itowns/docs/#home">itowns</a> framework on which <code>ud-viz</code> is builded.</p><p>&quot;background_image_layer&quot; define where and how to query the background image of the ground (<a href="http://www.itowns-project.org/itowns/docs/#api/Layer/ColorLayer">ColorLayer</a>).</p><ul><li>Let's see how it looks like now:</li></ul><p><img src="./Pictures/2.png" alt="2"></p><ul><li>Okay we are close, add these lines in <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a>:</li></ul><pre class="prettyprint source lang-json"><code>&quot;3DTilesLayers&quot;: [
    {
      &quot;id&quot;: &quot;3d-tiles-layer-building&quot;,
      &quot;url&quot;: &quot;./assets/3DTiles/buildings/tileset.json&quot;,
      &quot;color&quot;: &quot;0xFFFFFF&quot;
    }
]
</code></pre><p>Here data (geometries of buildings) are not collected from a distant server but locally, you need to download the content <a href="/examples/assets/3DTiles/buildings/"><code>buildings</code> folder</a> in <code>./assets/3DTiles</code>.</p><p>with curl &amp; tar :</p><pre class="prettyprint source"><code>curl https://codeload.github.com/VCityTeam/UD-Viz/tar.gz/master | tar -xz --strip=4 UD-Viz-master/examples/assets/3DTiles/buildings
</code></pre><p>with wget &amp; tar:</p><pre class="prettyprint source"><code>wget -O - https://codeload.github.com/VCityTeam/UD-Viz/tar.gz/master | tar -xz --strip=4 &quot;UD-Viz-master/examples/assets/3DTiles/buildings&quot;
</code></pre><p>Here is what you should see now</p><p><img src="./Pictures/3.png" alt="3"></p><p>That's it Lyon is here! Now we are going to add our zeppelin.</p><h2 id="create-a-worldscript">Create a worldscript</h2><p>First we are going to attach a <a href="/src/Game/GameObject/Component/WorldScript.js"><code>WorldScript</code></a> to our <code>GameManager</code> game object. A world script is used to customize the world simulation, you can put your code in different events called by the game engine.</p><ul><li>In <code>bootstrap.js</code>, complete the declaration of the <code>myWorld</code> object as the following:</li></ul><pre class="prettyprint source lang-js"><code>gameObject: {
    name: 'GameManager',
    static: true,
    components: {
        WorldScript: {
            idScripts: ['worldGameManager'],
        }
    },
},
</code></pre><p><code>static</code> set to <code>true</code> is used for internal optimization and is meaning that this gameobject is not moving into the 3D scene.</p><p>Now our <code>GameManager</code> game object is linked to a world script named <code>worldGameManager</code>. We need to import that script in our game.</p><ul><li>To do so add these lines to your <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> file.</li></ul><pre class="prettyprint source lang-json"><code>&quot;assetsManager&quot;: {
    &quot;worldScripts&quot;: {
        &quot;worldGameManager&quot;: {
            &quot;path&quot;: &quot;./assets/worldScripts/worldGameManager.js&quot;
        }
    }
}
</code></pre><p>Now we need to create the <code>worldGameManager.js</code>(<a href="/examples/assets/worldScripts/worldGameManager.js">Check out the final version</a>) world script in the new folder <code>./assets/worldScripts/</code>.</p><ul><li>Fill the script with the following skeleton:</li></ul><pre class="prettyprint source lang-js"><code>let Game;

module.exports = class WorldGameManager {
  constructor(conf, GameModule) {
    this.conf = conf;
    Game = GameModule;
  }

  init() {}

  tick() {}
};
</code></pre><ul><li><code>conf</code> is metadata that could be passed into the json file but here there is none. <code>GameModule</code> is the dynamic import of the <a href="/src/Game/Game.js">library</a> which is used to code inside a worldscript context.</li><li><code>init</code> is called when the gameobject is added, and <code>tick</code> is called every world simulation step.</li></ul><h2 id="add-the-zeppelin-gameobject">Add the zeppelin gameobject</h2><ul><li>Let's add the zeppelin, add these lines into <code>init</code> method of <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager.js</code></a>.</li></ul><pre class="prettyprint source lang-js"><code>  init() {
    //a context containing all references needed for scripting game
    const worldContext = arguments[1];
    const world = worldContext.getWorld();

    this.zeppelin = new Game.GameObject({
      name: 'zeppelin',
      components: {
        Render: { idRenderData: 'zeppelin' },
      },
    });

    world.addGameObject(this.zeppelin, worldContext, world.getGameObject());
  }
</code></pre><p>We create a new gameobject called zeppelin and a <a href="/src/Game/GameObject/Component/Render.js">Render</a> component is added with an id of the 3D model.</p><p>As always when we point to assets with an id, we need to import that asset (here a 3D model). We gonna to use this <a href="/examples/assets/models/Zeppelin_Labex_IMU.glb">one</a>.</p><ul><li>Like the worldscript add these lines in your <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> file :</li></ul><pre class="prettyprint source lang-json"><code>&quot;assetsManager&quot;: {
    &quot;renderData&quot;: {
      &quot;zeppelin&quot;: {
        &quot;path&quot;: &quot;./assets/models/Zeppelin_Labex_IMU.glb&quot;,
        &quot;anchor&quot;: &quot;center_min&quot;,
        &quot;rotation&quot;: {
          &quot;x&quot;: 0,
          &quot;y&quot;: 0,
          &quot;z&quot;: 1.57
          }
      }
    },
    &quot;worldScripts&quot;: {
      &quot;worldGameManager&quot;: {
        &quot;path&quot;: &quot;./assets/worldScripts/worldGameManager.js&quot;
      }
    }
  }
</code></pre><p><code>path</code> point to your .glb <code>anchor</code> means where the origin of the object is taken here at the bottom centered of the 3D model <code>rotation</code> tweak a custom rotation in your 3D model</p><p>Ok let's see what's happen on screen</p><p><img src="./Pictures/4.png" alt="4"></p><p>Yes a zeppelin appears on the middle of the scene ! trust me...</p><h2 id="create-a-localscript">Create a localscript</h2><p>Ok let's add a <a href="/src/Game/GameObject/Component/LocalScript.js">LocalScript</a> now to focus this zeppelin with the camera. These scripts are used to customize client-side game.</p><ul><li>GameManager in <code>bootstrap.js</code> becomes:</li></ul><pre class="prettyprint source lang-js"><code>gameObject: {
    name: 'GameManager',
    static: true,
    components: {
        WorldScript: {
            idScripts: ['worldGameManager'],
        },
        LocalScript: {
          conf: {
            nameGO2Focus: 'zeppelin',
            cameraAngle: 0.51,
            offsetZ: 10,
            minDist: 50,
            maxDist: 1000,
          },
          idScripts: ['focus'],
        },
    },
}
</code></pre><ul><li>Import it the same way that the worldscript with these lines in your <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> file.</li></ul><pre class="prettyprint source lang-json"><code>&quot;localScripts&quot;: {
    &quot;focus&quot;: {
       &quot;path&quot;: &quot;./assets/localScripts/focus.js&quot;
    }
}
</code></pre><p>A localscript skeleton is like so:</p><pre class="prettyprint source lang-js"><code>

let udviz;

module.exports = class MyClass {
  constructor(conf, udvizBundle) {
    this.conf = conf;
    udviz = udvizBundle;
  }

  init() {}

  tick() {}
};
</code></pre><p><code>conf</code> is metadata that could be passed into the json file but here there is none. <code>udvizBundle</code> is the dynamic import of the ud-viz framework which is used to code inside a localscript context.</p><ul><li>And here is the <a href="/examples/assets/localScripts/focus.js">focus.js</a> script, copy it in the folder <code>./assets/localScripts</code></li></ul><p>Ok here is what the game looks like now, you should also be able to zoom in/out with the wheel !</p><p><img src="./Pictures/5.png" alt="5"></p><h2 id="inputs">Inputs</h2><p>Ok in the next steps we are gonna to move the zeppelin above the city.</p><ul><li>Let's add a new <code>commands.js</code> local script. Complete the declaration of the GameManager game object in <code>bootstrap.js</code> like below:</li></ul><pre class="prettyprint source lang-js"><code>gameObject: {
    name: 'GameManager',
    static: true,
    components: {
        WorldScript: {
            idScripts: ['worldGameManager'],
        },
        LocalScript: {
            idScripts: ['focus', 'commands'],
        },
    },
}
</code></pre><ul><li>Modify <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> to import it</li></ul><pre class="prettyprint source lang-json"><code>&quot;localScripts&quot;: {
      &quot;focus&quot;: {
        &quot;path&quot;: &quot;./assets/localScripts/focus.js&quot;
      },
      &quot;commands&quot;: {
        &quot;path&quot;: &quot;./assets/localScripts/commands.js&quot;
      }
    }
</code></pre><ul><li>Then copy this <a href="/examples/assets/localScripts/commands.js">commands.js</a> local scrip in the folder <code>./assets/localScripts</code>.</li></ul><p>Now commands are send to world simulation but the world simulation don't know what to do with them.</p><ul><li>In the <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager.js</code></a> add these lines in the <code>tick</code> function</li></ul><pre class="prettyprint source lang-js"><code>tick() {
    const worldContext = arguments[1];
    const dt = worldContext.getDt();
    const commands = worldContext.getCommands();
    const speedTranslate = 0.05;
    const speedRotate = 0.0003;
    const zeppelin = this.zeppelin;

    commands.forEach(function (cmd) {
      switch (cmd.getType()) {
        case Game.Command.TYPE.MOVE_FORWARD:
          zeppelin.move(
            zeppelin.computeForward().setLength(dt * speedTranslate)
          );
          break;
        case Game.Command.TYPE.MOVE_BACKWARD:
          zeppelin.move(
            zeppelin.computeBackwardVector().setLength(dt * speedTranslate)
          );
          break;
        case Game.Command.TYPE.MOVE_LEFT:
          zeppelin.rotate(new Game.THREE.Vector3(0, 0, speedRotate * dt));
          break;
        case Game.Command.TYPE.MOVE_RIGHT:
          zeppelin.rotate(new Game.THREE.Vector3(0, 0, -speedRotate * dt));
          break;
        default:
          throw new Error('command not handle ', cmd.getType());
      }
    });
  }
</code></pre><ul><li>You can now pilot the zeppelin! Try it with the Z,Q,S,D or the arrows keys.</li></ul><h2 id="add-collisions">Add collisions</h2><p>Now we are going to add some collectable spheres.</p><ul><li>In <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager.js</code></a> add the method <code>createCollectableSphere</code></li></ul><pre class="prettyprint source lang-js"><code>createCollectableSphere(x, y) {
  const size = 10;

  const result = new Game.GameObject({
    name: 'collectable_sphere',
    static: true,
    components: {
      Render: {
        idRenderData: 'sphere',
        color: [Math.random(), Math.random(), Math.random()],
      },
    },
    transform: {
      position: [x, y, size],
      scale: [size, size, size],
    },
  });

  return result;
}
</code></pre><ul><li>and then inside the <code>init</code> method</li></ul><pre class="prettyprint source lang-js"><code>//add collectable sphere at random position
const range = 400;
const minRange = 50;
for (let i = 0; i &lt; 10; i++) {
  let x = (Math.random() - 0.5) * range;
  let y = (Math.random() - 0.5) * range;

  if (x > 0) {
    x += minRange;
  } else {
    x -= minRange;
  }

  if (y > 0) {
    y += minRange;
  } else {
    y -= minRange;
  }

  const s = this.createCollectableSphere(x, y);
  world.addGameObject(s, worldContext, world.getGameObject());
}
</code></pre><ul><li>You should see spheres around your zeppelin (<strong>zoom out</strong> :smile:)</li></ul><p><img src="./Pictures/6.png" alt="6"></p><p>ok that's nice, now let handle the collision with these objects.</p><ul><li>First add a <a href="/src/Game/GameObject/Component/Collider.js">Collider</a> component to these spheres in <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager.js</code></a></li></ul><pre class="prettyprint source lang-js"><code>  createCollectableSphere(x, y) {
    const size = 10;

    const result = new Game.GameObject({
      name: 'collectable_sphere',
      static: true,
      components: {
        Render: {
          idRenderData: 'sphere',
          color: [Math.random(), Math.random(), Math.random()],
        },
        Collider: {
          shapes: [
            {
              type: 'Circle',
              center: { x: 0, y: 0 },
              radius: size / 2,
            },
          ],
        },
      },
      transform: {
        position: [x, y, size],
        scale: [size, size, size],
      },
    });

    return result;
  }
</code></pre><ul><li>Then add a <a href="/src/Game/GameObject/Component/Collider.js">Collider</a> component to the zeppelin in the <code>init</code> method inside <code>this.zeppelin</code> declaration:</li></ul><pre class="prettyprint source lang-js"><code>this.zeppelin = new Game.GameObject({
  name: 'zeppelin',
  components: {
    Render: { idRenderData: 'zeppelin' },
    Collider: {
      shapes: [
        {
          type: 'Circle',
          center: { x: 0, y: 0 },
          radius: 10,
        },
      ],
    },
  },
});
</code></pre><p>Ok now let's add a worldscript to the zeppelin to handle collision.</p><p>Create a new worldscript import it with the config files and create it in the assets.</p><pre class="prettyprint source lang-js"><code>

let Game;

module.exports = class Zeppelin {
  constructor(conf, GameModule) {
    this.conf = conf;
    Game = GameModule;
  }

  //called when this gameobject collider components collides with another one collider components
  onEnterCollision() {
    const go = arguments[0];
    const result = arguments[1];
    const worldContext = arguments[2];

    const goCollided = result.b.getGameObject();
    worldContext.getWorld().removeGameObject(goCollided.getUUID());
  }
};
</code></pre><p>Check out <a href="/examples/assets/worldScripts/zeppelin.js">zeppelin.js</a></p><p>When you touch spheres with the zeppelin they are disapearing !!</p><h2 id="add-some-ui">Add some UI</h2><p>We are going to display the count of spheres collected.</p><p>The collision with spheres is detected inside a <strong>WorldScript</strong>, and the rendering of game (where to add UI for example) is handle by the <strong>LocalScript</strong>. We need to transfer this data from <a href="/examples/assets/worldScripts/zeppelin.js"><code>zeppelin.js</code></a> (worldScript) to a <a href="/examples/assets/localScripts/zeppelin.js"><code>zeppelin.js</code></a> (localScript).</p><ul><li>First add the <em>localscript</em> <a href="/examples/assets/localScripts/zeppelin.js"><code>zeppelin.js</code></a> to your zeppelin gameobject in your <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager.js</code></a>.</li></ul><pre class="prettyprint source lang-js"><code>LocalScript: {
  idScripts: ['zeppelin'],
  conf: { sphereCount: 0 },
}
</code></pre><p>Here we are going to use the conf attribute of LocalScript.</p><ul><li>Inside <a href="/examples/assets/worldScripts/zeppelin.js"><code>zeppelin.js</code></a> (<em>worldscript</em>) the <code>onEnterCollision()</code> becomes:</li></ul><pre class="prettyprint source lang-js"><code>onEnterCollision() {
  const go = arguments[0];
  const result = arguments[1];
  const worldContext = arguments[2];

  const goCollided = result.b.getGameObject();
  worldContext.getWorld().removeGameObject(goCollided.getUUID());

  const zeppelinLocalScript = go.fetchLocalScripts()['zeppelin'];
  zeppelinLocalScript.conf.sphereCount++;
}
</code></pre><p>Here the conf of the <em>localscript</em> is modified, this will trigger a update event on the <em>localscript</em>.</p><ul><li>The <a href="/examples/assets/localScripts/zeppelin.js"><code>zeppelin.js</code></a> (<em>localscript</em>) looks like this:</li></ul><pre class="prettyprint source lang-js"><code>

let udviz;

module.exports = class Zeppelin {
  constructor(conf, udvizBundle) {
    this.conf = conf;
    udviz = udvizBundle;
    this.labelSphereCount = null;
  }

  init() {
    const localContext = arguments[1];

    const l = document.createElement('div');
    this.labelSphereCount = l;
    localContext.getGameView().appendToUI(l);
    this.updateUI();
  }

  updateUI() {
    this.labelSphereCount.innerHTML = 'Sphere count: ' + this.conf.sphereCount;
  }

  update() {
    this.updateUI();
  }
};
</code></pre><p>Now when a sphere is collected the ui update the sphere count !</p><h2 id="audio">Audio</h2><p>Let's play a sound when a sphere is collected. First add this <a href="/examples/assets/sounds/ballon_pop.wav">wav file</a> in <code>./assets/sounds/</code>. Then import it with the assetsManager.</p><ul><li>Add these lines in <a href="/examples/assets/config/local_game_config.json"><code>local_game_config.json</code></a> in the <em>assetsManager</em> Object:</li></ul><pre class="prettyprint source lang-json"><code>&quot;sounds&quot;: {
  &quot;ballon_pop&quot;: {
    &quot;path&quot;: &quot;./assets/sounds/ballon_pop.wav&quot;
  }
}
</code></pre><ul><li>Then add an <em>Audio</em> component in your zeppelin gameobject in <a href="/examples/assets/worldScripts/worldGameManager.js"><code>worldGameManager</code></a>.</li></ul><pre class="prettyprint source lang-js"><code>Audio: {
  sounds: ['ballon_pop'],
}
</code></pre><p>Okay everything is setup to play a sound !</p><ul><li>In <a href="/examples/assets/localScripts/zeppelin.js"><code>zeppelin.js</code></a> (<em>localscript</em>) the update function becomes:</li></ul><pre class="prettyprint source lang-js"><code>update() {
  const go = arguments[0];
  const s = go.getComponent(udviz.Game.Audio.TYPE).getSounds()[
    'ballon_pop'
  ];
  s.play();

  this.updateUI();
}
</code></pre><p>That's it a sound will be played when the sphere is collected !</p><h2 id="conclusion">Conclusion</h2><p>Congrats you have finished this tutorial, you are now able to :</p><ul><li>Create a project from scratch</li><li>Importing assets in a ud-viz game</li><li>Parameterized itowns layers</li><li>Manipulating components of gameobjects</li><li>Using user inputs</li><li>Pass data from WorldScript to LocalScript</li><li>Play audio</li></ul></article></section><footer class="footer" id="PeOAagUepe"><div class="wrapper">Fork: <a href="https://github.com/VCityTeam/UD-Viz">https://github.com/VCityTeam/UD-Viz</a></div></footer></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">@ud-viz/node</a><div class="mobile-nav-links"><div class="navbar-item"><a id="Github-mobile" href="https://github.com/VCityTeam/UD-Viz" target="_blank">Github</a></div><div class="navbar-item"><a id="Examples-mobile" href="https://ud-viz.vcityliris.data.alpha.grandlyon.com/" target="_blank">Examples</a></div><div class="navbar-item"><a id="udvizHome-mobile" href="../" target="">udviz</a></div><div class="navbar-item"><a id="udvizBrowser-mobile" href="../browser" target="">udvizBrowser</a></div><div class="navbar-item"><a id="udvizShared-mobile" href="../shared" target="">udvizShared</a></div><div class="navbar-item"><a id="udvizNode-mobile" href="../node" target="">udvizNode</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="E7waCAy2XRqwWyiPHs27e"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ExpressAppWrapper.html">ExpressAppWrapper</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="ldqb2Wm34h2ZC-PZS5b5b"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Debug.html">Debug</a></div><div class="sidebar-section-children"><a href="module-Test.html">Test</a></div><div class="sidebar-section-children"><a href="module-udvizNode.html">udvizNode</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="6SktYTtJPiRmfyomlylaA"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-Changelog.html">Changelog</a></div><div class="sidebar-section-children"><a href="tutorial-ArchitectureMVCTargetDesign.html">ArchitectureMVCTargetDesign</a></div><div class="sidebar-section-children"><a href="tutorial-Configuring-the-Document-model-of-an-UDV-deployment.html">Configuring-the-Document-model-of-an-UDV-deployment</a></div><div class="sidebar-section-children"><a href="tutorial-Contributing.html">Contributing</a></div><div class="sidebar-section-children"><a href="tutorial-Definitions.html">Definitions</a></div><div class="sidebar-section-children"><a href="tutorial-LocalGameTutorial.html">LocalGameTutorial</a></div><div class="sidebar-section-children"><a href="tutorial-ReleasePublish.html">ReleasePublish</a></div><div class="sidebar-section-children"><a href="tutorial-Reproducibility.html">Reproducibility</a></div><div class="sidebar-section-children"><a href="tutorial-View3D.html">View3D</a></div><div class="sidebar-section-children"><a href="tutorial-ContributeData.html">ContributeData</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>