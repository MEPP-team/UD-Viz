<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="custom.css"><title>Source: Data.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">@ud-viz/core</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="zfK0YV7ZH575QJHAqgl7-"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="AudioComponent.html">AudioComponent</a></div><div class="sidebar-section-children"><a href="AudioModel.html">AudioModel</a></div><div class="sidebar-section-children"><a href="ColliderComponent.html">ColliderComponent</a></div><div class="sidebar-section-children"><a href="ColliderController.html">ColliderController</a></div><div class="sidebar-section-children"><a href="ColliderModel.html">ColliderModel</a></div><div class="sidebar-section-children"><a href="Command.html">Command</a></div><div class="sidebar-section-children"><a href="Component.html">Component</a></div><div class="sidebar-section-children"><a href="Context.html">Context</a></div><div class="sidebar-section-children"><a href="Controller.html">Controller</a></div><div class="sidebar-section-children"><a href="Diff.html">Diff</a></div><div class="sidebar-section-children"><a href="EventSender.html">EventSender</a></div><div class="sidebar-section-children"><a href="ExternalScriptComponent.html">ExternalScriptComponent</a></div><div class="sidebar-section-children"><a href="ExternalScriptModel.html">ExternalScriptModel</a></div><div class="sidebar-section-children"><a href="GameScriptComponent.html">GameScriptComponent</a></div><div class="sidebar-section-children"><a href="GameScriptModel.html">GameScriptModel</a></div><div class="sidebar-section-children"><a href="Interpolator.html">Interpolator</a></div><div class="sidebar-section-children"><a href="Model.html">Model</a></div><div class="sidebar-section-children"><a href="Object3D.html">Object3D</a></div><div class="sidebar-section-children"><a href="PartialString.html">PartialString</a></div><div class="sidebar-section-children"><a href="ProcessInterval.html">ProcessInterval</a></div><div class="sidebar-section-children"><a href="RenderComponent.html">RenderComponent</a></div><div class="sidebar-section-children"><a href="RenderModel.html">RenderModel</a></div><div class="sidebar-section-children"><a href="ScriptBase.html">ScriptBase</a></div><div class="sidebar-section-children"><a href="ScriptController.html">ScriptController</a></div><div class="sidebar-section-children"><a href="ScriptModel.html">ScriptModel</a></div><div class="sidebar-section-children"><a href="ShapeWrapper.html">ShapeWrapper</a></div><div class="sidebar-section-children"><a href="State.html">State</a></div><div class="sidebar-section-children"><a href="StringComposer.html">StringComposer</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="R8quvLvReZu8LRsKVhZLw"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Audio.html">Audio</a></div><div class="sidebar-section-children"><a href="module-Collider.html">Collider</a></div><div class="sidebar-section-children"><a href="module-ExternalScript.html">ExternalScript</a></div><div class="sidebar-section-children"><a href="module-GameScript.html">GameScript</a></div><div class="sidebar-section-children"><a href="module-Render.html">Render</a></div><div class="sidebar-section-children"><a href="module-Script.html">Script</a></div><div class="sidebar-section-children"><a href="module-Type.html">Type</a></div><div class="sidebar-section-children"><a href="module-udvizCore.html">udvizCore</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="42yK279qqqSmrVBxyFnuV"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-Changelog.html">Changelog</a></div><div class="sidebar-section-children"><a href="tutorial-ArchitectureMVCTargetDesign.html">ArchitectureMVCTargetDesign</a></div><div class="sidebar-section-children"><a href="tutorial-Configuring-the-Document-model-of-an-UDV-deployment.html">Configuring-the-Document-model-of-an-UDV-deployment</a></div><div class="sidebar-section-children"><a href="tutorial-LocalGameTutorial.html">LocalGameTutorial</a></div><div class="sidebar-section-children"><a href="tutorial-ReleasePublish.html">ReleasePublish</a></div><div class="sidebar-section-children"><a href="tutorial-Reproducibility.html">Reproducibility</a></div><div class="sidebar-section-children"><a href="tutorial-View3D.html">View3D</a></div><div class="sidebar-section-children"><a href="tutorial-ContributeData.html">ContributeData</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="l9b6mUYBXzTDw4dD3CmI5"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#AllEventSenderCallback">AllEventSenderCallback</a></div><div class="sidebar-section-children"><a href="global.html#checkIfSubStringIsEuler">checkIfSubStringIsEuler</a></div><div class="sidebar-section-children"><a href="global.html#checkIfSubStringIsVector3">checkIfSubStringIsVector3</a></div><div class="sidebar-section-children"><a href="global.html#CircleJSON">CircleJSON</a></div><div class="sidebar-section-children"><a href="global.html#ContextListener">ContextListener</a></div><div class="sidebar-section-children"><a href="global.html#dataUriToBuffer">dataUriToBuffer</a></div><div class="sidebar-section-children"><a href="global.html#eulerArrayFromURIComponent">eulerArrayFromURIComponent</a></div><div class="sidebar-section-children"><a href="global.html#EventSenderCallback">EventSenderCallback</a></div><div class="sidebar-section-children"><a href="global.html#getAttributeByPath">getAttributeByPath</a></div><div class="sidebar-section-children"><a href="global.html#imageToDataURI">imageToDataURI</a></div><div class="sidebar-section-children"><a href="global.html#int32ArrayToObject">int32ArrayToObject</a></div><div class="sidebar-section-children"><a href="global.html#objectEquals">objectEquals</a></div><div class="sidebar-section-children"><a href="global.html#objectOverWrite">objectOverWrite</a></div><div class="sidebar-section-children"><a href="global.html#objectParse">objectParse</a></div><div class="sidebar-section-children"><a href="global.html#objectParseNumeric">objectParseNumeric</a></div><div class="sidebar-section-children"><a href="global.html#objectToInt32Array">objectToInt32Array</a></div><div class="sidebar-section-children"><a href="global.html#PolygonJSON">PolygonJSON</a></div><div class="sidebar-section-children"><a href="global.html#ProcessIntervalTickRequester">ProcessIntervalTickRequester</a></div><div class="sidebar-section-children"><a href="global.html#removeEmptyValues">removeEmptyValues</a></div><div class="sidebar-section-children"><a href="global.html#TraverseCallback">TraverseCallback</a></div><div class="sidebar-section-children"><a href="global.html#vector3ArrayFromURIComponent">vector3ArrayFromURIComponent</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="udvizHome" href="/docs/html" target="">udviz</a></div><div class="navbar-item"><a id="udvizBrowser" href="/docs/html/browser" target="">udvizBrowser</a></div><div class="navbar-item"><a id="udvizCore" href="/docs/html/core" target="">udvizCore</a></div><div class="navbar-item"><a id="udvizNode" href="/docs/html/node" target="">udvizNode</a></div><div class="navbar-item"><a id="Github" href="https://github.com/VCityTeam/UD-Viz" target="_blank">Github</a></div><div class="navbar-item"><a id="Examples" href="https://ud-viz.vcityliris.data.alpha.grandlyon.com/" target="_blank">Examples</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">Data.js</h1></header><article><pre class="prettyprint source lang-js"><code>const THREE = require('three');
const Type = require('./Type');

/**
 * MODULE Data
 *
 * @exports Data
 */

/**
 * @class
 */
class PartialString {
  /**
   * Part of a global string
   *
   * @param {string} stringUUID - uuid of the initial string splited
   * @param {string} data - part of the initial string
   */
  constructor(stringUUID, data) {
    /**
     * uuid of the initial string splited
     *
     *  @type {string}
     */
    this.stringUUID = stringUUID;

    /**
     * part of the initial string
     *
     *  @type {string}
     */
    this.data = data;

    /**
     * index of the position of this in the initial string
     *
     *  @type {number}
     */
    this.index = -1;

    /**
     * total number of partial string of the initial string
     *
     *  @type {number}
     */
    this.totalPartialStringCount = -1;
  }

  /**
   * Set the index of this
   *
   * @param {number} index - index of this
   */
  setIndex(index) {
    this.index = index;
  }

  /**
   * Set the total partial string count
   *
   * @param {number} value - total partial string count of this
   */
  setTotalPartialStringCount(value) {
    this.totalPartialStringCount = value;
  }
}

/**
 * @class
 */
class StringComposer {
  /**
   * Recompose string with {@link PartialString}
   */
  constructor() {
    /**
     * buffer of all string being recompose
     *
     * @type {Object&lt;string,Object&lt;number,PartialString>>}
     */
    this.buffer = {};
  }

  /**
   * Recompose a string with a partial string
   *
   * @param {PartialString} partialString - part of a string being recompose
   * @returns {string|null} - return null if the recomposition still need partial string, the initial string otherwise
   */
  recompose(partialString) {
    const stringUUID = partialString.stringUUID;
    if (!this.buffer[stringUUID]) {
      // First partial string of this string
      this.buffer[stringUUID] = {};
    }

    // Record partial string
    this.buffer[stringUUID][partialString.index] = partialString;

    // Check if all the partial string are here
    if (
      Object.keys(this.buffer[stringUUID]).length ==
      partialString.totalPartialStringCount
    ) {
      // Can recompose initial string
      let bufferString = '';
      for (
        let index = 0;
        index &lt; partialString.totalPartialStringCount;
        index++
      ) {
        bufferString += this.buffer[stringUUID][index].data;
      }

      // clean buffer
      delete this.buffer[stringUUID];

      return bufferString;
    }

    return null; // No complete
  }
}

/**
 * Max size of the data of a {@link PartialString}
 *
 * @memberof StringComposer
 * @type {number}
 */
StringComposer.MAX_STRING_SIZE = 10000;

/**
 * Split a large string (superior at {@link StringComposer.MAX_STRING_SIZE}) into {@link PartialString}
 *
 * @memberof StringComposer
 * @param {string} largeString - a string with a size superior at {@link StringComposer.MAX_STRING_SIZE}
 * @returns {PartialString[]} - an array containing all the {@link PartialString}
 */
StringComposer.splitString = function (largeString) {
  const stringUUID = THREE.MathUtils.generateUUID();
  const result = [];

  // Cut in several partial message
  while (largeString.length > StringComposer.MAX_STRING_SIZE) {
    const sliceMessage = largeString.slice(0, StringComposer.MAX_STRING_SIZE);
    largeString = largeString.slice(
      StringComposer.MAX_STRING_SIZE,
      largeString.length
    );
    result.push(new PartialString(stringUUID, sliceMessage));
  }

  // Add what need
  if (largeString.length) {
    result.push(new PartialString(stringUUID, largeString));
  }

  // Push info to recompose string
  for (let index = 0; index &lt; result.length; index++) {
    const partialString = result[index];
    partialString.setIndex(index);
    partialString.setTotalPartialStringCount(result.length);
  }

  return result;
};

/**
 * Take an array of string and check if it is in vector3 format
 *
 * @param {Array&lt;string>} subString - array of string
 * @returns {boolean} - true if it is vector3 format
 */
function checkIfSubStringIsVector3(subString) {
  if (subString.length != 3) {
    // Need three string
    return false;
  }

  for (let index = 0; index &lt; subString.length; index++) {
    const element = subString[index];
    if (!Type.isNumeric(element)) {
      // All string should be numerics
      return false;
    }
  }

  return true;
}

/**
 * Take an array of string and check if it is in euler format
 *
 * @param {Array&lt;string>} subString - array of string
 * @returns {boolean} - true if it is euler format
 */
function checkIfSubStringIsEuler(subString) {
  if (subString.length != 4) {
    // Need four string
    return false;
  }

  // Three first string have to be numerics
  if (!Type.isNumeric(subString[0])) return false;
  if (!Type.isNumeric(subString[1])) return false;
  if (!Type.isNumeric(subString[2])) return false;

  // The last one has to be an euler order
  if (
    subString[3] == 'XYZ' ||
    subString[3] == 'XZY' ||
    subString[3] == 'ZYX' ||
    subString[3] == 'ZXY' ||
    subString[3] == 'YZX' ||
    subString[3] == 'YXZ'
  ) {
    return true;
  }
  return false;
}

/**
 * Taking a string from the unpacking URI and splitting it into an array of strings.
 *
 * @param {string} uriComp - The string from the unpacking URI
 * @returns {Array&lt;string>} - returns the array of strings if it is in vector3 format, otherwise returns null
 */
function vector3ArrayFromURIComponent(uriComp) {
  const subString = uriComp.split(',');

  if (checkIfSubStringIsVector3(subString)) {
    return subString;
  }
  return null;
}

/**
 * Taking a string from the unpacking URI and splitting it into an array of strings.
 *
 * @param {string} uriComp - The string from the unpacking URI
 * @returns {Array&lt;string>} - returns the array of strings if it is in euler format, otherwise returns null
 */
function eulerArrayFromURIComponent(uriComp) {
  const subString = uriComp.split(',');

  if (checkIfSubStringIsEuler(subString)) {
    return subString;
  }
  return null;
}

/**
 * Convert an Object into a Int32Array
 *
 * @param {object} obj - object to convert
 * @returns {Int32Array} - array converted
 */
function objectToInt32Array(obj) {
  const OString = JSON.stringify(obj);
  const SABuffer = new SharedArrayBuffer(
    Int32Array.BYTES_PER_ELEMENT * OString.length
  );
  const sArray = new Int32Array(SABuffer);

  for (let i = 0; i &lt; OString.length; i++) {
    sArray[i] = OString.charCodeAt(i);
  }

  return sArray;
}

/**
 * Convert a Int32Array into an Object
 *
 * @param {Int32Array} array - array to convert
 * @returns {object} - object converted
 */
function int32ArrayToObject(array) {
  const str = String.fromCharCode.apply(this, array);
  return JSON.parse(str);
}

/**
 * Convert a data URI into a Buffer
 *
 * @param {string} uri - data uri to convert
 * @returns {Buffer|null} - the buffer of the data uri or null if uri is not a data uri
 */
function dataUriToBuffer(uri) {
  if (!/^data:/i.test(uri)) {
    return null; // Its not a Data URI
  }
  // Strip newlines
  uri = uri.replace(/\r?\n/g, '');
  // Split the URI up into the "metadata" and the "data" portions
  const firstComma = uri.indexOf(',');
  if (firstComma === -1 || firstComma &lt;= 4) {
    throw new TypeError('malformed data: URI');
  }
  // Remove the "data:" scheme and parse the metadata
  const meta = uri.substring(5, firstComma).split(';');
  let charset = '';
  let base64 = false;
  const type = meta[0] || 'text/plain';
  let typeFull = type;
  for (let i = 1; i &lt; meta.length; i++) {
    if (meta[i] === 'base64') {
      base64 = true;
    } else {
      typeFull += `;${meta[i]}`;
      if (meta[i].indexOf('charset=') === 0) {
        charset = meta[i].substring(8);
      }
    }
  }
  // Defaults to US-ASCII only if type is not provided
  if (!meta[0] &amp;&amp; !charset.length) {
    typeFull += ';charset=US-ASCII';
    charset = 'US-ASCII';
  }
  // Get the encoded data portion and decode URI-encoded chars
  const encoding = base64 ? 'base64' : 'ascii';
  const data = unescape(uri.substring(firstComma + 1));
  const buffer = Buffer.from(data, encoding);
  // Set `.type` and `.typeFull` properties to MIME type
  buffer.type = type;
  buffer.typeFull = typeFull;
  // Set the `.charset` property
  buffer.charset = charset;
  return buffer;
}

/**
 * Removes empty fields from a FormData. Useful for update requests that
 * would update those fields to an empty string if they were sent in the
 * body. To check if a value is empty, this function just convert it into
 * a boolean.
 *
 * @param {FormData} formData The form data.
 * @returns {FormData} The same data, without the fields containing an empty value.
 */
function removeEmptyValues(formData) {
  const emptyKeys = [];
  formData.forEach((value, key) => {
    if (!value) {
      emptyKeys.push(key);
    }
  });
  emptyKeys.forEach((key) => {
    formData.delete(key);
  });
  return formData;
}

/**
 * Converts the raw content of an array buffer (as retrieved by a GET request
 * on a file) to a data URI. This is required, for example, to display images
 * fetched from the server. As we need authentication headers to retrieve some
 * protected files, we get the raw data dynamically and need to convert it to
 * a data URI do display it.
 * The basic scheme of the URI is defined in the
 * [RFC 2397](https://tools.ietf.org/html/rfc2397), with the mediaType set to
 * `mimeType` and the raw data converted to base64.
 *
 * @param {ArrayBuffer} arrayBuffer The binary data of the file.
 * @param {string} mimeType The media type. Any type supported by a data URI
 * should work. For images, use `image/png` or `image/jpeg` for instance.
 * @param {number} chunkSize The size of the chunks used to process the raw
 * data. If you get an exception saying that too many arguments were passed as
 * parameters, try reducing this value.
 * @returns {string} - data uri
 */
function imageToDataURI(arrayBuffer, mimeType, chunkSize = 8 * 1024) {
  // The response is a raw file, we need to convert it to base64
  // File (ArrayBuffer) -> Byte array -> String -> Base64 string
  const responseArray = new Uint8Array(arrayBuffer);

  // Make a string from the response array. As the array can be
  // too long (each value will be passed as an argument to
  // String.fromCharCode), we need to split it into chunks
  let responseAsString = '';
  for (let i = 0; i &lt; responseArray.length / chunkSize; i++) {
    responseAsString += String.fromCharCode.apply(
      null,
      responseArray.slice(i * chunkSize, (i + 1) * chunkSize)
    );
  }

  const b64data = 'data:' + mimeType + ';base64,' + btoa(responseAsString);
  return b64data;
}

/**
 * Gets an attribute of an object from the given path. To get nested attributes,
 * the path qualifiers must be separated by dots ('.'). If the path is not
 * nested (does not contain any dot), the function is equivalent to `obj[path]`.
 *
 * @param {object} obj - object to get attribute
 * @param {string} path - path to get the attribute
 * @returns {*} - attribute vaue
 * @example
 * const obj = {test: {msg: "Hello world !"}};
 * console.log(getAttributeByPath(obj, "test.msg")); // prints "Hello world !";
 * console.log(getAttributeByPath(obj, "other")); // undefined
 */
function getAttributeByPath(obj, path) {
  const segs = path.split('.');
  let val = obj;
  for (const seg of segs) {
    val = val[seg];
    if (val === undefined) {
      break;
    }
  }
  return val;
}

/**
 * Check if two json object are equals
 *
 * @param {object} j1 - first json object
 * @param {object} j2 - second json object
 * @returns {boolean} - true if both json are equals, false otherwise
 */
function objectEquals(j1, j2) {
  const traverse = function (json1, json2) {
    for (const key in json1) {
      if (json1[key] instanceof Object) {
        if (json2[key] instanceof Object) {
          if (traverse(json1[key], json2[key])) {
            continue;
          } else {
            return false;
          }
        } else {
          return false;
        }
      } else {
        if (json2[key] == json1[key]) {
          continue;
        } else {
          return false;
        }
      }
    }
    return true; // All check have passed meaning is equals
  };

  return traverse(j1, j2);
}

/**
 * Overwrite identical key of jsonOverWrited with the one matching in jsonModel
 * Create key of jsonModel which are not in jsonOverWrited
 *
 * @param {object} jsonOverWrited - json object overwrited
 * @param {object} jsonModel - json object used as model to overwrite
 */
function objectOverWrite(jsonOverWrited, jsonModel) {
  const traverse = function (json1, json2) {
    // write the ones not in jsonOverWrited
    for (const key in json2) {
      if (json1[key] == undefined) {
        json1[key] = json2[key];
      }
    }

    // check in jsonOverWrited the ones existing in jsonModel
    for (const key in json1) {
      if (json1[key] instanceof Object) {
        if (json2[key] instanceof Object) traverse(json1[key], json2[key]);
      } else {
        if (json2[key] != undefined) {
          json1[key] = json2[key];
        }
      }
    }
  };

  traverse(jsonOverWrited, jsonModel);
}

/**
 * Apply a callback to each key value couple of a json object
 *
 * @param {object} json - json object to parse
 * @param {Function} cb - callback to apply (first argument is the object containing the key and second is the key)
 * @returns {object} - json object parsed
 */
function objectParse(json, cb) {
  for (const key in json) {
    if (json[key] instanceof Object) {
      this.parse(json[key], cb);
    } else {
      cb(json, key);
    }
  }
  return json;
}

/**
 * Replace all valid number string in a json object by a float
 *
 * @param {object} json - json object to parse
 * @returns {object} - json object parsed
 */
function objectParseNumeric(json) {
  return this.parse(json, function (j, key) {
    if (Type.isNumeric(j[key])) {
      j[key] = parseFloat(j[key]);
    }
  });
}
module.exports = {
  PartialString: PartialString,
  StringComposer: StringComposer,
  checkIfSubStringIsEuler: checkIfSubStringIsEuler,
  checkIfSubStringIsVector3: checkIfSubStringIsVector3,
  vector3ArrayFromURIComponent: vector3ArrayFromURIComponent,
  eulerArrayFromURIComponent: eulerArrayFromURIComponent,
  objectToInt32Array: objectToInt32Array,
  int32ArrayToObject: int32ArrayToObject,
  dataUriToBuffer: dataUriToBuffer,
  removeEmptyValues: removeEmptyValues,
  imageToDataURI: imageToDataURI,
  getAttributeByPath: getAttributeByPath,
  objectEquals: objectEquals,
  objectOverWrite: objectOverWrite,
  objectParse: objectParse,
  objectParseNumeric: objectParseNumeric,
};
</code></pre></article></section><footer class="footer" id="PeOAagUepe"><div class="wrapper">Fork: <a href="https://github.com/VCityTeam/UD-Viz">https://github.com/VCityTeam/UD-Viz</a></div></footer></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">@ud-viz/core</a><div class="mobile-nav-links"><div class="navbar-item"><a id="udvizHome-mobile" href="/docs/html" target="">udviz</a></div><div class="navbar-item"><a id="udvizBrowser-mobile" href="/docs/html/browser" target="">udvizBrowser</a></div><div class="navbar-item"><a id="udvizCore-mobile" href="/docs/html/core" target="">udvizCore</a></div><div class="navbar-item"><a id="udvizNode-mobile" href="/docs/html/node" target="">udvizNode</a></div><div class="navbar-item"><a id="Github-mobile" href="https://github.com/VCityTeam/UD-Viz" target="_blank">Github</a></div><div class="navbar-item"><a id="Examples-mobile" href="https://ud-viz.vcityliris.data.alpha.grandlyon.com/" target="_blank">Examples</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="zfK0YV7ZH575QJHAqgl7-"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="AudioComponent.html">AudioComponent</a></div><div class="sidebar-section-children"><a href="AudioModel.html">AudioModel</a></div><div class="sidebar-section-children"><a href="ColliderComponent.html">ColliderComponent</a></div><div class="sidebar-section-children"><a href="ColliderController.html">ColliderController</a></div><div class="sidebar-section-children"><a href="ColliderModel.html">ColliderModel</a></div><div class="sidebar-section-children"><a href="Command.html">Command</a></div><div class="sidebar-section-children"><a href="Component.html">Component</a></div><div class="sidebar-section-children"><a href="Context.html">Context</a></div><div class="sidebar-section-children"><a href="Controller.html">Controller</a></div><div class="sidebar-section-children"><a href="Diff.html">Diff</a></div><div class="sidebar-section-children"><a href="EventSender.html">EventSender</a></div><div class="sidebar-section-children"><a href="ExternalScriptComponent.html">ExternalScriptComponent</a></div><div class="sidebar-section-children"><a href="ExternalScriptModel.html">ExternalScriptModel</a></div><div class="sidebar-section-children"><a href="GameScriptComponent.html">GameScriptComponent</a></div><div class="sidebar-section-children"><a href="GameScriptModel.html">GameScriptModel</a></div><div class="sidebar-section-children"><a href="Interpolator.html">Interpolator</a></div><div class="sidebar-section-children"><a href="Model.html">Model</a></div><div class="sidebar-section-children"><a href="Object3D.html">Object3D</a></div><div class="sidebar-section-children"><a href="PartialString.html">PartialString</a></div><div class="sidebar-section-children"><a href="ProcessInterval.html">ProcessInterval</a></div><div class="sidebar-section-children"><a href="RenderComponent.html">RenderComponent</a></div><div class="sidebar-section-children"><a href="RenderModel.html">RenderModel</a></div><div class="sidebar-section-children"><a href="ScriptBase.html">ScriptBase</a></div><div class="sidebar-section-children"><a href="ScriptController.html">ScriptController</a></div><div class="sidebar-section-children"><a href="ScriptModel.html">ScriptModel</a></div><div class="sidebar-section-children"><a href="ShapeWrapper.html">ShapeWrapper</a></div><div class="sidebar-section-children"><a href="State.html">State</a></div><div class="sidebar-section-children"><a href="StringComposer.html">StringComposer</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="R8quvLvReZu8LRsKVhZLw"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Audio.html">Audio</a></div><div class="sidebar-section-children"><a href="module-Collider.html">Collider</a></div><div class="sidebar-section-children"><a href="module-ExternalScript.html">ExternalScript</a></div><div class="sidebar-section-children"><a href="module-GameScript.html">GameScript</a></div><div class="sidebar-section-children"><a href="module-Render.html">Render</a></div><div class="sidebar-section-children"><a href="module-Script.html">Script</a></div><div class="sidebar-section-children"><a href="module-Type.html">Type</a></div><div class="sidebar-section-children"><a href="module-udvizCore.html">udvizCore</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="42yK279qqqSmrVBxyFnuV"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-Changelog.html">Changelog</a></div><div class="sidebar-section-children"><a href="tutorial-ArchitectureMVCTargetDesign.html">ArchitectureMVCTargetDesign</a></div><div class="sidebar-section-children"><a href="tutorial-Configuring-the-Document-model-of-an-UDV-deployment.html">Configuring-the-Document-model-of-an-UDV-deployment</a></div><div class="sidebar-section-children"><a href="tutorial-LocalGameTutorial.html">LocalGameTutorial</a></div><div class="sidebar-section-children"><a href="tutorial-ReleasePublish.html">ReleasePublish</a></div><div class="sidebar-section-children"><a href="tutorial-Reproducibility.html">Reproducibility</a></div><div class="sidebar-section-children"><a href="tutorial-View3D.html">View3D</a></div><div class="sidebar-section-children"><a href="tutorial-ContributeData.html">ContributeData</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="l9b6mUYBXzTDw4dD3CmI5"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#AllEventSenderCallback">AllEventSenderCallback</a></div><div class="sidebar-section-children"><a href="global.html#checkIfSubStringIsEuler">checkIfSubStringIsEuler</a></div><div class="sidebar-section-children"><a href="global.html#checkIfSubStringIsVector3">checkIfSubStringIsVector3</a></div><div class="sidebar-section-children"><a href="global.html#CircleJSON">CircleJSON</a></div><div class="sidebar-section-children"><a href="global.html#ContextListener">ContextListener</a></div><div class="sidebar-section-children"><a href="global.html#dataUriToBuffer">dataUriToBuffer</a></div><div class="sidebar-section-children"><a href="global.html#eulerArrayFromURIComponent">eulerArrayFromURIComponent</a></div><div class="sidebar-section-children"><a href="global.html#EventSenderCallback">EventSenderCallback</a></div><div class="sidebar-section-children"><a href="global.html#getAttributeByPath">getAttributeByPath</a></div><div class="sidebar-section-children"><a href="global.html#imageToDataURI">imageToDataURI</a></div><div class="sidebar-section-children"><a href="global.html#int32ArrayToObject">int32ArrayToObject</a></div><div class="sidebar-section-children"><a href="global.html#objectEquals">objectEquals</a></div><div class="sidebar-section-children"><a href="global.html#objectOverWrite">objectOverWrite</a></div><div class="sidebar-section-children"><a href="global.html#objectParse">objectParse</a></div><div class="sidebar-section-children"><a href="global.html#objectParseNumeric">objectParseNumeric</a></div><div class="sidebar-section-children"><a href="global.html#objectToInt32Array">objectToInt32Array</a></div><div class="sidebar-section-children"><a href="global.html#PolygonJSON">PolygonJSON</a></div><div class="sidebar-section-children"><a href="global.html#ProcessIntervalTickRequester">ProcessIntervalTickRequester</a></div><div class="sidebar-section-children"><a href="global.html#removeEmptyValues">removeEmptyValues</a></div><div class="sidebar-section-children"><a href="global.html#TraverseCallback">TraverseCallback</a></div><div class="sidebar-section-children"><a href="global.html#vector3ArrayFromURIComponent">vector3ArrayFromURIComponent</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>